{% extends '/admin/signatures/index.html' %}
{% import '/base/html-renderer.html' as renderer %}

{% block additional_js %}
  {{ super() }}

  <script type="text/javascript">
  $('.ui.dropdown')
      .dropdown();

  $(".attach-file-signature_file").click(function() {
    $(this).parent().find("#signature_file").click();
  });

  $('#signature_file')
    .on('change', function(e) {
      var name = e.target.files[0].name;
      $('.attach-file-signature_file', $(e.target).parent()).val(name);
    });
	</script>
{% endblock %}

{% block dashboard_title %}
  {% if 'edit' in request.path %}
    Edit Signature: {{ signature.owner.first_name }} {{ signature.owner.last_name }}
  {% else %}
    Create Signature
  {% endif %}
{% endblock %}

{% block breadcrumbs %}
  {{ super() }}
  <div class="divider"> / </div>
  {% if 'edit' in request.path %}
    <div class="active section">Edit Signature: {{ signature.owner.first_name }} {{ signature.owner.last_name }}</div>
  {% else %}
    <div class="active section">Create Signature</div>
  {% endif %}

{% endblock %}

{% block content %}
<div class="">
  <div class="ui segment">
    <form method="POST" class="ui form" enctype="multipart/form-data">
      {{ form.csrf_token }}
      <div class="two fields">
      {{ renderer.render_select(form.user) }}
      {{ renderer.render_fileinput(form.signature_file) }}
      </div>
      {% if 'create' in request.path %}
      <button name="create" type="submit" class="ui button primary">Create</button>
      {% elif 'edit' in request.path %}
      <a onclick="$('.modal.edit').modal('show')" class="ui primary button">
        Edit
      </a>
      {% endif %}

      {% if 'edit' in request.path %}
      <div class="ui small modal edit">
        <div class="header">Edit Signature</div>
        <div class="content">
          <h4 class="ui headers" >
            Are you sure you want to edit <span class="ui primary text">{{ signature.owner.first_name }} {{ signature.owner.last_name }}</span> 's signature?
          </h4>
          <button class="ui right floated primary button" onclick="$('.ui.form').submit()" style="margin-bottom: 1em;">
            Edit
          </button>
          <button class="ui right floated button" onclick="$('.modal.edit').modal('hide')">Cancel</button>
        </div>
      </div>
    {% endif %}

    </form>
    {% if form.errors | length > 0 %}
      <div class="ui message negative">
        <ul>
        {% for error, msg in form.errors.items() %}
          <li> {{ error }} {{ msg | join('') }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}


  </div>
</div>

{% endblock %}
