{% extends '/organizations/view.html' %}
{% import '/base/organization-renderer.html' as org_renderer %}

{% block title %}{{ organization.name }}{% endblock %}

{% block dashboard_title %}
{{ organization.name }}
{# <a class="bug popup icon item" data-content="Edit This Page" href="{{ url_for('organizations.edit', organization_id=organization.id) }}">
    <h3><i class="edit icon"></i></h3>
</a>
#}
{% endblock %}

{% block breadcrumbs %}
    {{ super() }}
    {% if 'admin/organizations/' in request.path %}
		{% if request.endpoint == 'admin.organizations.view_classes' %}
		<div class="active section">Classes</div>
		{% else %}
		<a href="{{ url_for('admin.organizations.view_classes', organization_id=organization.id) }}" class="section">Classes</a>
		{% endif %}
	{% else %}
        {% if request.endpoint == 'organizations.view_classes' %}
        <div class="active section">Classes</div>
        {% else %}
        <a href="{{ url_for('organizations.view_classes', organization_id=organization.id) }}" class="section">Classes</a>
        {% endif %}
    {% endif %}
{% endblock %}



{% block content %}
{{ org_renderer.render_organization_dashboard_menu_bar(organization) }}

<h2 class="ui header">
    Classes
    {% if current_user.has_organization_roles("admin", "staff") %}
        <a class="ui primary tertiary right floated large button" href="{{ url_for('admin.classes.create_or_edit', organization_id=organization.id) }}">
            <i class="add icon"></i> Add Class
        </a>
    {% endif %}
</h2>
<div class="ui divider"></div>
<div style="margin-top: 1ex;">
    <table class="ui celled table">
    <thead>
        <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Operation</th>
        </tr>
    </thead>
    <tbody>
    {% for class_ in classes %}
        <tr>
        <td>
            <a href="{{ url_for('admin.classes.view', class_id=class_.id, organization_id=organization.id) }}">{{ class_.name }}</a>
        </td>
        <td class="ten wide">
            <div class="three-line-text">
                {{ class_.get_description() | safe }}
            </div>
        </td>
        <td class="single line">
            <a class="ui circular primary icon button link pop" data-content="view" data-position="bottom left" href="{{ url_for('admin.classes.view', class_id=class_.id, organization_id=organization.id) }}"><i class="eye icon"></i></a>
            {% if current_user.is_admin_current_organization() %}
                <a class="ui circular primary icon button link pop" data-content="edit" data-position="bottom left" href="{{ url_for('admin.classes.create_or_edit', class_id=class_.id, organization_id=organization.id) }}"><i class="edit icon"></i></a>
                <a class="ui circular primary icon button link pop" data-content="copy" data-position="bottom left" href="{{ url_for('admin.classes.copy', class_id=class_.id, organization_id=organization.id) }}"><i class="copy icon"></i></a>
                <a onclick="showDeleteModal('{{ class_.id }}')" class="ui circular button negative icon"><i class="ban icon"></i></a>

                <div class="ui small modal {{class_.id}}">
                    <div class="header">Delete Class</div>
                    <div class="content">
                    <h4 class="ui headers" >
                        Are you sure you want to delete <span class="ui red text">{{ class_.name }}</span> class?
                    </h4>
                    <a class="ui right floated negative button" style="margin-bottom: 1em;" href="{{ url_for('admin.classes.delete', class_id=class_.id, organization_id=organization.id) }}">
                        Delete</i>
                    </a>
                    <button class="ui right floated button" onclick="showDeleteModal()">Cancel</button>
                    </div>
                </div>
            {% endif %}
        </td>
        </tr>
    {% endfor %}
    </tbody>
    </table>

    {% if not classes %}
        <div class="ui horizontal divider" style="margin: 3em auto 0 auto; max-width: 30vw; color: grey">
            No classes in this organization.
        </div>
    {% endif %}
</div>

{% endblock %}

{% block additional_js %}
<script>
    function showDeleteModal(logo_id) {
        logo_id ?  $('.ui.small.modal.'+logo_id).modal('show') : $('.ui.small.modal').modal('hide') 
    ;
    }
	$('.link.pop').popup({
		delay: {
			show: 800,
	  }
	})
</script>
{% endblock %}